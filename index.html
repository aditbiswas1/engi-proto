<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>Engineer homepage proto</title>
		<style>
			html, body {
				height: 100%;
			}

			body {
				background-color: #FFFFFF;
				margin: 0;
				font-family: Arial;
				overflow: hidden;
			}

			a {
				color: #ffffff;
			}


			#menu {
				position: absolute;
				bottom: 20px;
				width: 100%;
				text-align: center;
			}

			.element {
				width: 140px;
				height: 180px;
				box-shadow: 0px 0px 20px rgba(0,255,255,0.5);
				border: 1px solid rgba(127,255,255,0.25);
				cursor: default;
			}

			.element:hover {
				box-shadow: 0px 0px 20px rgba(0,255,255,0.75);
				border: 1px solid rgba(127,255,255,0.75);
			}

				.element .number {
					position: absolute;
					top: 20px;
					right: 20px;
					font-size: 20px;
					color: rgba(127,255,255,0.75);
				}

				.element .symbol {
					position: absolute;
					top: 40px;
					width: 100%;
					font-size: 70px;
					text-align: center;
					color: rgba(255,255,255,0.75);
					font-weight: bold;

					-webkit-filter: drop-shadow(0px 0px 20px rgba(0,255,255,0.95));
					-moz-filter: drop-shadow(0px 0px 20px rgba(0,255,255,0.95));
					-o-filter: drop-shadow(0px 0px 20px rgba(0,255,255,0.95));
					-ms-filter: drop-shadow(0px 0px 20px rgba(0,255,255,0.95));
					filter: drop-shadow(0px 0px 20px rgba(0,255,255,0.95));
				}

				.element .details {
					position: absolute;
					top: 125px;
					width: 100%;
					font-size: 18px;
					text-align: center;
					color: rgba(127,255,255,0.75);
				}

			button {
				color: rgba(127,255,255,0.75);
				background: transparent;
				outline: 1px solid rgba(127,255,255,0.75);
				border: 0px;
				padding: 5px 10px;
				cursor: pointer;
			}
			button:hover {
				background-color: rgba(0,255,255,0.5);
			}
			button:active {
				color: #000000;
				background-color: rgba(0,255,255,0.75);
			}
		</style>
	</head>
	<body>
		<script type="text/javascript" src="js/jquery-1.10.1.min.js" ></script>
		<script type="text/javascript" src="js/underscore-min.js"></script>
		<script type="text/javascript" src="js/backbone-min.js"></script>
		<script src="js/three.min.js"></script>
		<script src="js/TrackballControls.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/CSS3DRenderer.js"></script>

		<div id="container"></div>

		<script>
			publicEvents = [
			{ name: "tech events", info: "blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			{ name: "mech events", info: "blah-mech-blah"},
			];

			subevents = [
				{name: "subEvent1", info: "blah blah this is subevent"},
				{name: "subEvent2", info: "blah blah this is subevent2"},
				{name: "subEvent3", info: "blah blah this is subevent3"},
				{name: "subEvent4", info: "blah blah this is subevent4"},
			];

			

		</script>
		<script type="text/javascript">

			//custom tween apis

			var spinTween = function( spingObject){

			}
			var App = {};
			App.Models = {};
			App.Collections = {};
			App.Views = {};

			App.Models.Event = Backbone.Model.extend({

			});
			App.Models.SubEvent = Backbone.Model.extend({

			});
			App.Collections.Subevents = Backbone.Collection.extend({
				model: App.Models.SubEvent
			});

			App.Collections.Events = Backbone.Collection.extend({
				model: App.Models.Event
			});

			App.Views.EventView = Backbone.View.extend({
				tagName: "div",
				className: "element",
				events: {
					"click": "selected"
				},
				initialize: function(){
					this.bind("unselect", this.unselected);
					
					this.object =  new THREE.CSS3DObject( this.el );
					this.el.style.backgroundColor = 'rgba(0,255,127,' + ( Math.random() * 0.5 + 0.25 ) + ')';
					this.$el.html(this.model.toJSON().name);
					this.object.position.x = Math.random() * 4000 - 2000;
					this.object.position.y = Math.random() * 4000 - 2000;
					this.object.position.z = Math.random() * 4000 - 2000;

					//cube 

				},
				render: function(event){
					return this;
				},

				selected: function(){
					console.log(this.model.toJSON().name + " is being clicked");
					App.eventsCollectionView.trigger("itemSelected", this);

					
				},
				unselected: function(){
					new TWEEN.Tween(this.object.rotation ).to( {
						x: Math.random() * 2 * Math.PI,
						z: Math.random() * 2 * Math.PI }, 5000 )
					.easing( TWEEN.Easing.Elastic.Out).start();
					this.$el.fadeOut(2000);


				}


			});
			App.Views.SubeventView = Backbone.View.extend({
				tagName: "div",
				className: "element",
				subeelements: [],
				events: {
					"click" : "selected"
				},
				initialize: function(){
					this.on("destroy", this.destroy);
					this.object =  new THREE.CSS3DObject( this.el );
					this.el.style.backgroundColor = 'rgba(0,50,127,' + ( Math.random() * 0.5 + 0.25 ) + ')';
					this.$el.html(this.model.toJSON().name);
					this.object.position.x = Math.random() * 4000 - 2000;
					this.object.position.y = Math.random() * 4000 - 2000;
					this.object.position.z = Math.random() * 4000 - 2000;

				},
				selected: function(){
					console.log("subview is selected");
					App.eventsCollectionView.trigger("subviewSelect", this);

				},
				destroy: function(){
					this.$el.fadeOut();
				}
				

			});

			App.Views.SubeventsCollectionView = Backbone.View.extend({
				objects: [],
				views: [],
				initialize: function(){
					this.render();
				},
				render: function(event){
					this.collection.each(function(subevent){
						var subeventView = new App.Views.SubeventView({model: subevent});
						
						this.objects.push( subeventView.object );
						this.views.push(subeventView);

					}, this);
					return this;
				}
				

			});
			App.Views.EventsCollectionView = Backbone.View.extend({
				el: $("#container"),
				objects: [],
				targets :  {
						sphere: [], 
					},

				camera : new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 5000 ),
				scene: new THREE.Scene(),
				renderer: new THREE.CSS3DRenderer(),
				
				views: [],
				initialize: function(){
					this.once("itemSelected", this.itemSelected, this);
					this.once("subviewSelect", this.subviewSelected, this);
					this.camera.position.z = 1800;

					this.render();

					var vector = new THREE.Vector3();

					for ( var i = 0, l = this.objects.length; i < l; i ++ ) {

						var phi = Math.acos( -1 + ( 2 * i ) / l );
						var theta = Math.sqrt( l * Math.PI ) * phi;

						var object = new THREE.Object3D();
						var radius = 1000;
						object.position.x = radius * Math.cos( theta ) * Math.sin( phi );
						object.position.y = radius * Math.sin( theta ) * Math.sin( phi );
						object.position.z = radius * Math.cos( phi );

						vector.copy( object.position ).multiplyScalar( 2);

						object.lookAt( vector );

						this.targets.sphere.push( object );
					
					}


					this.renderer.setSize( window.innerWidth, window.innerHeight );
					this.renderer.domElement.style.position = 'absolute';
					this.el.appendChild(this.renderer.domElement);
					this.controls = new THREE.TrackballControls( this.camera, this.renderer.domElement );
					this.controls.rotateSpeed = 0.5;
					this.controls.addEventListener( 'change', this.renderScene );
					this.transform( this.targets.sphere, 5000 );
						
				},

				//custom events
				itemSelected: function(eventItem){
					this.objects = [eventItem.object];
					for( i = 0; i<= this.scene.__objects.length; i ++){
						var object = this.scene.__objects[i];
						if (  object !== eventItem.object){ 
							this.scene.remove(object);
							_.each(this.views,function(eventView){
								
									if (eventItem !== eventView){
										eventView.trigger("unselect");

									}
								
							});
							 }
					}

			

				//start the subview

				this.subeventsCollectionView = new App.Views.SubeventsCollectionView( {collection : new App.Collections.Subevents(subevents)} );
				var mainView = this;
				_.each(App.eventsCollectionView.subeventsCollectionView.objects, function(object){
				 this.scene.add(object);
				 mainView.objects.push(object);
				});
				var x = [];
				for ( var i = 0; i < this.objects.length; i ++ ) {

					

					var object = new THREE.Object3D();
					object.position.x = ( ( i % 3 ) * 200 ) - 300;
					object.position.y = ( - ( Math.floor( i / 3 ) % 3 ) * 200 ) + 80;
					object.position.z = ( Math.floor( i / 9 ) );

					x.push( object );

				}
				
				this.transform(x, 1000);
				var target = new THREE.Object3D();
				target.position.x = 0;
				target.position.y = 0;
				target.position.z = ( Math.floor( 3 / 25 ) ) + 300;

				var x = new THREE.Object3D();
				x.position.x = 0;
				x.position.y = 0;
				x.position.z = 1;
				var vector = new THREE.Vector3( );
				vector.copy( x.position )

				target.lookAt( vector );
				
				this.transformCamera(target, 1000);

			},
			subviewSelected: function(subView){
				MainView = this;
				_.each(this.subeventsCollectionView.views,function(view){
							
							if(view.object !== subView.object){
								
								MainView.objects.pop(view.object);
								view.trigger("destroy");
							}
							});
				
			},
			updateControls: function(){
				controls = this.controls;
				controls.update();
			},

				render: function(event){
					this.collection.each(function(eventModel){
						var eventView = new App.Views.EventView({model: eventModel});
						eventView.render();
						this.scene.add(eventView.object);
						this.objects.push( eventView.object );
						this.views.push(eventView);

					}, this);

					return this;
				},

				transform: function(targets, duration){
					TWEEN.removeAll();

					for ( var i = 0; i < this.objects.length; i ++ ) {

						var object = this.objects[ i ];
						var target = targets[ i ];

						new TWEEN.Tween( object.position )
							.to( { x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration )
							.easing( TWEEN.Easing.Exponential.InOut )
							.start();

						new TWEEN.Tween( object.rotation )
							.to( { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration )
							.easing( TWEEN.Easing.Exponential.InOut )
							.start();

					}

					new TWEEN.Tween( this )
						.to( {}, duration * 2 )
						.onUpdate( this.renderScene )
						.start();

				},

				transformCamera: function(target, duration){
					camera = this.camera;
					new TWEEN.Tween(camera.position)
						.to( { x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration )
							.easing( TWEEN.Easing.Exponential.InOut )
							.start();
					new TWEEN.Tween( camera.rotation )
							.to( { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration )
							.easing( TWEEN.Easing.Exponential.InOut )
							.start();
					new TWEEN.Tween( camera.up )
							.to( { x: target.up.x, y: target.up.y, z: target.up.z }, Math.random() * duration + duration )
							.easing( TWEEN.Easing.Exponential.InOut )
							.start();

				},
				renderScene: function(){
					renderer = App.eventsCollectionView.renderer;
					camera = App.eventsCollectionView.camera;
					scene = App.eventsCollectionView.scene;
					renderer.render( scene, camera );

				},

				onWindowResize: function(){
				renderer = App.eventsCollectionView.renderer;
				camera = App.eventsCollectionView.camera;
					
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}
			});

			
			
			App.init = function(){
				App.eventsCollection = new App.Collections.Events(publicEvents);
				
				App.eventsCollectionView = new App.Views.EventsCollectionView({collection: App.eventsCollection}); 
				var i = 0;
				function animate(t ) {
					/*if(i <= 300){ App.eventsCollectionView.camera.position.z -= 8};
					i+= 1;
					App.eventsCollectionView.camera.lookAt(App.eventsCollectionView.scene.position);*/
					
					App.eventsCollectionView.renderScene();
					requestAnimationFrame( animate );
					TWEEN.update();
					App.eventsCollectionView.updateControls();

				};
				window.addEventListener( 'resize', App.eventsCollectionView.onWindowResize, false );
				animate(new Date().getTime());

			} 
			

			App.init();
		</script>
	</body>
</html>
